package main

import (
	"fmt"
	"log"
	"os"

	"github.com/csye7125-su24-team05/webapp-cve-processor/app/db"
	"github.com/csye7125-su24-team05/webapp-cve-processor/app/helper"
)

func main() {
	fmt.Println("Hello, World!")
	updateDatabase()
}

func updateDatabase() {

	db := db.CreateConnection()
	
	url := "https://github.com/CVEProject/cvelistV5/archive/refs/heads/main.zip"
	fmt.Println("Downloading file")
	err := helper.DownloadFile("cveList.zip", url)
	if err != nil {
		log.Fatalf("Error downloading file: %v", err)
		os.Exit(1)
	}
	fmt.Println("Downloaded file")

	// err = helper.Unzip("cveList.zip", "cve-list")
	err = helper.UnzipAndStore("cveList.zip", db)
	if err != nil {
		log.Fatalf("Error unzipping file: %v", err)
		os.Exit(1)
	}
}