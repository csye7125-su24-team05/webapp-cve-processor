#!/bin/sh

# Function to gracefully shut down the sidecar
shutdown_sidecar() {
  curl -fsI -X POST http://localhost:15020/quitquitquit
}

# Run the Go application
./gocve
app_exit_code=$?

# Check if the application ran successfully
if [ $app_exit_code -ne 0 ]; then
  echo "Application exited with code $app_exit_code"
  exit $app_exit_code
else
  echo "Application ran successfully"
fi

# Attempt to shut down the sidecar
if shutdown_sidecar; then
  echo "Sidecar shut down successfully"
else
  echo "Failed to shut down the sidecar"
fi

# Exit with the application's exit code
exit $app_exit_code