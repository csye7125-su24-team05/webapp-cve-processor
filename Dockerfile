# Build stage
FROM golang:1.22 AS builder

WORKDIR /app

COPY . .

RUN go mod download && go build -o /gocve

# Final stage
FROM alpine:3.20

WORKDIR /opt/app

COPY --from=builder /app/startup.sh /gocve ./

RUN apk --no-cache add curl=8.9.1-r0 && \
    chmod +x /opt/app/startup.sh && \
    chmod +x /opt/app/gocve

ENTRYPOINT ["/opt/app/startup.sh"]
